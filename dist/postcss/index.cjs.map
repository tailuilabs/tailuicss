{"version":3,"sources":["/Users/hosmann/Projects/TailUI/dist/postcss/index.cjs","../../src/postcss/index.ts"],"names":[],"mappings":"AAAA;AACE;AACF,yDAA8B;AAC9B,iCAA8B;AAC9B;AACA;ACLA,gEAAe;AACf,wEAAiB;AACjB,oFAAqD;AAoBrD,IAAM,OAAA,EAAuC,CAAC,QAAA,EAAyB,CAAC,CAAA,EAAA,GAAM;AAC5E,EAAA,MAAM,EAAE,UAAU,EAAA,EAAI,6CAAA,OAAqB,CAAA;AAE3C,EAAA,OAAO;AAAA,IACL,aAAA,EAAe,QAAA;AAAA,IAEf,IAAA,CAAK,IAAA,EAAY;AACf,MAAA,MAAM,SAAA,EAAW,cAAA,CAAK,OAAA,CAAQ,OAAA,CAAQ,GAAA,CAAI,CAAA,EAAG,SAAS,CAAA;AAEtD,MAAA,GAAA,CAAI,CAAC,YAAA,CAAG,UAAA,CAAW,QAAQ,CAAA,EAAG;AAC5B,QAAA,MAAA;AAAA,MACF;AAGA,MAAA,MAAM,MAAA,EAAQ,YAAA,CAAG,WAAA,CAAY,QAAQ,CAAA,CAClC,MAAA,CAAO,CAAA,CAAA,EAAA,GAAK,CAAA,CAAE,UAAA,CAAW,KAAK,EAAA,GAAK,CAAA,CAAE,QAAA,CAAS,MAAM,CAAC,CAAA,CACrD,IAAA,CAAK,CAAA;AAER,MAAA,GAAA,CAAI,KAAA,CAAM,OAAA,IAAW,CAAA,EAAG,MAAA;AAGxB,MAAA,IAAI,OAAA,EAAS,KAAA,CACV,GAAA,CAAI,CAAA,IAAA,EAAA,GAAQ,YAAA,CAAG,YAAA,CAAa,cAAA,CAAK,IAAA,CAAK,QAAA,EAAU,IAAI,CAAA,EAAG,MAAM,CAAC,CAAA,CAC9D,IAAA,CAAK,IAAI,CAAA;AAGZ,MAAA,OAAA,EAAS,kBAAA,CAAmB,MAAM,CAAA;AAGlC,MAAA,MAAM,OAAA,EAAS,iBAAA,CAAQ,KAAA,CAAM,MAAM,CAAA;AAGnC,MAAA,IAAI,eAAA,EAAgC,IAAA;AACpC,MAAA,IAAA,CAAK,WAAA,CAAY,UAAA,EAAY,CAAC,MAAA,EAAA,GAAW;AACvC,QAAA,GAAA,CAAI,MAAA,CAAO,OAAA,IAAW,YAAA,EAAc;AAClC,UAAA,eAAA,EAAiB,MAAA;AAAA,QACnB;AAAA,MACF,CAAC,CAAA;AAED,MAAA,GAAA,CAAI,cAAA,EAAgB;AAElB,QAAA,MAAA,CAAO,KAAA,CAAM,KAAA,CAAM,CAAA,CAAE,OAAA,CAAQ,CAAA,CAAE,OAAA,CAAQ,CAAA,IAAA,EAAA,GAAQ;AAC7C,UAAC,cAAA,CAA0B,MAAA,CAAO,IAAA,CAAK,KAAA,CAAM,CAAC,CAAA;AAAA,QAChD,CAAC,CAAA;AACD,QAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,yBAAA,EAAuB,KAAA,CAAM,MAAM,CAAA,eAAA,EAAkB,KAAA,CAAM,GAAA,CAAI,CAAA,CAAA,EAAA,GAAK,CAAA,CAAE,OAAA,CAAQ,KAAA,EAAO,EAAE,CAAA,CAAE,OAAA,CAAQ,MAAA,EAAQ,EAAE,CAAC,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC,CAAA,CAAA;AAC/H,MAAA;AAC2F,QAAA;AACoB,QAAA;AACtH,MAAA;AACF,IAAA;AACF,EAAA;AACF;AAEiB;AAEF;AAMkC;AAClC,EAAA;AACL,EAAA;AAEe,EAAA;AACc,IAAA;AACnB,IAAA;AACO,MAAA;AACrB,MAAA;AACF,IAAA;AAE0B,IAAA;AAGa,IAAA;AAChB,IAAA;AACE,MAAA;AACvB,MAAA;AACF,IAAA;AAGY,IAAA;AACS,IAAA;AACe,IAAA;AACd,MAAA;AACK,MAAA;AACzB,MAAA;AACF,IAAA;AAGoD,IAAA;AAC1C,IAAA;AACN,IAAA;AACN,EAAA;AAEO,EAAA;AACT;ADhDoJ;AACA;AACA","file":"/Users/hosmann/Projects/TailUI/dist/postcss/index.cjs","sourcesContent":[null,"import fs from 'fs';\nimport path from 'path';\nimport postcss, { PluginCreator, Root, AtRule } from 'postcss';\nimport { resolveConfig, PluginOptions } from '../config';\n\n/**\n * TailUI PostCSS Plugin (Zero-Config)\n *\n * Two jobs:\n * 1. Auto-injects all ui.*.css component styles before @tailwind components\n *    so the dev never has to manage CSS import order manually.\n * 2. Processes @style { ... } blocks in ui.*.css files.\n *\n * Resolves the styles directory from ui.config.json automatically.\n * The dev's CSS file just needs:\n *   @tailwind base;\n *   @tailwind components;\n *   @tailwind utilities;\n *\n * Usage in postcss.config.js:\n *   plugins: { '@tailuicss/core/postcss': {}, tailwindcss: {} }\n */\nconst plugin: PluginCreator<PluginOptions> = (options: PluginOptions = {}) => {\n  const { stylesDir } = resolveConfig(options);\n\n  return {\n    postcssPlugin: 'tailui',\n\n    Once(root: Root) {\n      const fullPath = path.resolve(process.cwd(), stylesDir);\n\n      if (!fs.existsSync(fullPath)) {\n        return;\n      }\n\n      // Collect all ui.*.css files\n      const files = fs.readdirSync(fullPath)\n        .filter(f => f.startsWith('ui.') && f.endsWith('.css'))\n        .sort();\n\n      if (files.length === 0) return;\n\n      // Read and concatenate all CSS content\n      let allCSS = files\n        .map(file => fs.readFileSync(path.join(fullPath, file), 'utf8'))\n        .join('\\n');\n\n      // Process @style blocks before parsing (supports nested braces)\n      allCSS = processStyleBlocks(allCSS);\n\n      // Parse the combined CSS into a PostCSS AST\n      const parsed = postcss.parse(allCSS);\n\n      // Find @tailwind components directive\n      let componentsRule: AtRule | null = null;\n      root.walkAtRules('tailwind', (atRule) => {\n        if (atRule.params === 'components') {\n          componentsRule = atRule;\n        }\n      });\n\n      if (componentsRule) {\n        // Insert all parsed nodes before @tailwind components\n        parsed.nodes.slice().reverse().forEach(node => {\n          (componentsRule as AtRule).before(node.clone());\n        });\n        console.log(`[TailUI] ✅ Injected ${files.length} component(s): ${files.map(f => f.replace('ui.', '').replace('.css', '')).join(', ')}`);\n      } else {\n        console.warn(`[TailUI] ⚠️  No \"@tailwind components\" directive found. Styles were not injected.`);\n        console.warn(`[TailUI] Make sure your CSS file contains: @tailwind base; @tailwind components; @tailwind utilities;`);\n      }\n    },\n  };\n};\n\nplugin.postcss = true;\n\nexport default plugin;\n\n/**\n * Process @style { ... } blocks, supporting nested braces.\n * Extracts the inner content and replaces the @style wrapper.\n */\nfunction processStyleBlocks(css: string): string {\n  let result = '';\n  let i = 0;\n\n  while (i < css.length) {\n    const idx = css.indexOf('@style', i);\n    if (idx === -1) {\n      result += css.slice(i);\n      break;\n    }\n\n    result += css.slice(i, idx);\n\n    // Find the opening brace\n    const braceStart = css.indexOf('{', idx);\n    if (braceStart === -1) {\n      result += css.slice(idx);\n      break;\n    }\n\n    // Count braces to find matching close\n    let depth = 1;\n    let j = braceStart + 1;\n    while (j < css.length && depth > 0) {\n      if (css[j] === '{') depth++;\n      else if (css[j] === '}') depth--;\n      j++;\n    }\n\n    // Extract inner content (between outermost braces)\n    const inner = css.slice(braceStart + 1, j - 1).trim();\n    result += inner;\n    i = j;\n  }\n\n  return result;\n}"]}