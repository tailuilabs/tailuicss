{"version":3,"sources":["../../src/plugin/index.ts","../../src/config.ts"],"sourcesContent":["import plugin from 'tailwindcss/plugin';\nimport fs from 'fs';\nimport path from 'path';\n \nimport { resolveConfig, type PluginOptions } from '../config';\n\n/**\n * TailUI — Tailwind CSS Plugin (Zero-Config)\n *\n * Automatically resolves the styles directory from ui.config.json\n * and adds it to Tailwind's content paths so .ui-* classes are\n * detected and not tree-shaken.\n */\nconst tailuiPlugin = plugin.withOptions(\n  (options: PluginOptions = {}) => {\n    const { stylesDir } = resolveConfig(options);\n\n    return function ({ /* addUtilities, addComponents, etc. */ }) {\n      const fullPath = path.resolve(process.cwd(), stylesDir);\n\n      if (!fs.existsSync(fullPath)) {\n        console.warn(`[TailUI] ⚠️ Styles directory not found: ${fullPath}`);\n        console.warn(`[TailUI] Run \"npx tailui init\" to create it.`);\n        return;\n      }\n\n      const files = fs\n        .readdirSync(fullPath)\n        .filter((f) => f.startsWith('ui.') && f.endsWith('.css'))\n        .sort();\n\n      if (files.length === 0) {\n        console.warn(`[TailUI] ⚠️ No ui.*.css files found in ${fullPath}`);\n        return;\n      }\n\n      // Log informatif lors du build Tailwind\n      console.log(\n        `[TailUI] ✅ Found ${files.length} component(s): ${files\n          .map((f) => f.replace('ui.', '').replace('.css', ''))\n          .join(', ')}`\n      );\n    };\n  },\n  (options: PluginOptions = {}) => {\n    const { stylesDir } = resolveConfig(options);\n    const fullPath = path.resolve(process.cwd(), stylesDir);\n\n    return {\n      // On ajoute les fichiers CSS au \"content\" de Tailwind \n      // pour que les classes .ui-* ne soient pas supprimées par le Purge/JIT\n      content: [path.join(fullPath, 'ui.*.css')],\n    };\n  }\n);\n\nexport default tailuiPlugin;","import fs from 'fs';\nimport path from 'path';\n\nexport const CONFIG_FILE = 'ui.config.json';\nexport const DEFAULT_DIR = 'ui';\n\nexport interface PluginOptions {\n  path?: string;\n  [key: string]: unknown;\n}\n\nexport interface TailUIConfig {\n  stylesDir?: string;\n  [key: string]: unknown;\n}\n\nexport interface ResolvedConfig {\n  stylesDir: string;\n  configPath: string;\n  config: TailUIConfig | null;\n}\n\n/**\n * Resolve the TailUI styles directory.\n *\n * Priority:\n *   1. Explicit `options.path` (from plugin config)\n *   2. `stylesDir` from ui.config.json\n *   3. Default: ./ui/styles\n */\nexport function resolveConfig(options: PluginOptions = {}): ResolvedConfig {\n  const configPath = path.join(process.cwd(), CONFIG_FILE);\n  let config: TailUIConfig | null = null;\n\n  if (fs.existsSync(configPath)) {\n    try {\n      config = JSON.parse(fs.readFileSync(configPath, 'utf8')) as TailUIConfig;\n    } catch (e) {\n      console.warn(`[TailUI] ⚠️  Failed to parse ${CONFIG_FILE}: ${(e as Error).message}`);\n    }\n  }\n\n  let stylesDir: string;\n  if (options.path) {\n    stylesDir = options.path;\n  } else if (config?.stylesDir) {\n    stylesDir = config.stylesDir;\n  } else {\n    stylesDir = `./${DEFAULT_DIR}/styles`;\n  }\n\n  const resolved = path.resolve(process.cwd(), stylesDir);\n  if (!resolved.startsWith(process.cwd())) {\n    console.warn(`[TailUI] ⚠️  stylesDir \"${stylesDir}\" resolves outside the project. Using default.`);\n    stylesDir = `./${DEFAULT_DIR}/styles`;\n  }\n\n  return { stylesDir, configPath, config };\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBAAmB;AACnB,IAAAA,aAAe;AACf,IAAAC,eAAiB;;;ACFjB,gBAAe;AACf,kBAAiB;AAEV,IAAM,cAAc;AACpB,IAAM,cAAc;AA0BpB,SAAS,cAAc,UAAyB,CAAC,GAAmB;AACzE,QAAM,aAAa,YAAAC,QAAK,KAAK,QAAQ,IAAI,GAAG,WAAW;AACvD,MAAI,SAA8B;AAElC,MAAI,UAAAC,QAAG,WAAW,UAAU,GAAG;AAC7B,QAAI;AACF,eAAS,KAAK,MAAM,UAAAA,QAAG,aAAa,YAAY,MAAM,CAAC;AAAA,IACzD,SAAS,GAAG;AACV,cAAQ,KAAK,0CAAgC,WAAW,KAAM,EAAY,OAAO,EAAE;AAAA,IACrF;AAAA,EACF;AAEA,MAAI;AACJ,MAAI,QAAQ,MAAM;AAChB,gBAAY,QAAQ;AAAA,EACtB,WAAW,QAAQ,WAAW;AAC5B,gBAAY,OAAO;AAAA,EACrB,OAAO;AACL,gBAAY,KAAK,WAAW;AAAA,EAC9B;AAEA,QAAM,WAAW,YAAAD,QAAK,QAAQ,QAAQ,IAAI,GAAG,SAAS;AACtD,MAAI,CAAC,SAAS,WAAW,QAAQ,IAAI,CAAC,GAAG;AACvC,YAAQ,KAAK,qCAA2B,SAAS,gDAAgD;AACjG,gBAAY,KAAK,WAAW;AAAA,EAC9B;AAEA,SAAO,EAAE,WAAW,YAAY,OAAO;AACzC;;;AD7CA,IAAM,eAAe,cAAAE,QAAO;AAAA,EAC1B,CAAC,UAAyB,CAAC,MAAM;AAC/B,UAAM,EAAE,UAAU,IAAI,cAAc,OAAO;AAE3C,WAAO,SAAU;AAAA;AAAA,IAA0C,GAAG;AAC5D,YAAM,WAAW,aAAAC,QAAK,QAAQ,QAAQ,IAAI,GAAG,SAAS;AAEtD,UAAI,CAAC,WAAAC,QAAG,WAAW,QAAQ,GAAG;AAC5B,gBAAQ,KAAK,qDAA2C,QAAQ,EAAE;AAClE,gBAAQ,KAAK,8CAA8C;AAC3D;AAAA,MACF;AAEA,YAAM,QAAQ,WAAAA,QACX,YAAY,QAAQ,EACpB,OAAO,CAAC,MAAM,EAAE,WAAW,KAAK,KAAK,EAAE,SAAS,MAAM,CAAC,EACvD,KAAK;AAER,UAAI,MAAM,WAAW,GAAG;AACtB,gBAAQ,KAAK,oDAA0C,QAAQ,EAAE;AACjE;AAAA,MACF;AAGA,cAAQ;AAAA,QACN,yBAAoB,MAAM,MAAM,kBAAkB,MAC/C,IAAI,CAAC,MAAM,EAAE,QAAQ,OAAO,EAAE,EAAE,QAAQ,QAAQ,EAAE,CAAC,EACnD,KAAK,IAAI,CAAC;AAAA,MACf;AAAA,IACF;AAAA,EACF;AAAA,EACA,CAAC,UAAyB,CAAC,MAAM;AAC/B,UAAM,EAAE,UAAU,IAAI,cAAc,OAAO;AAC3C,UAAM,WAAW,aAAAD,QAAK,QAAQ,QAAQ,IAAI,GAAG,SAAS;AAEtD,WAAO;AAAA;AAAA;AAAA,MAGL,SAAS,CAAC,aAAAA,QAAK,KAAK,UAAU,UAAU,CAAC;AAAA,IAC3C;AAAA,EACF;AACF;AAEA,IAAO,iBAAQ;","names":["import_fs","import_path","path","fs","plugin","path","fs"]}